   1:                    // Start with shared definitions...
   2: 0000               include "Megaprocessor_defs.asm";
   3:                    // ===============================================================
   4:                    // 
   5:                    // Megaprocessor
   6:                    // =============
   7:                    // This file holds definitions useful for writing assembler
   8:                    // programs for the Megaprocessor.
   9:                    //
  10:                    // This version : 15th May 2016
  11:                    //
  12:                    // ================================================================
  13:                    //
  14:                    // Coding
  15:                    // =======
  16:                    // definition for interrupt enable bit
  17: 0001               PS_INT_ENABLE_BIT               equ     0x01;
  18:                    
  19:                    // ================================================================
  20:                    //
  21:                    // To handle the 256 bytes of RAM built from discrete components:
  22: A000               INT_RAM_START                   equ     0xA000;
  23: 0100               INT_RAM_LEN                     equ     0x0100;
  24:                    
  25: 0004               INT_RAM_BYTES_ACROSS            equ     4;
  26: 0006               INT_RAM_BYTES_HEIGHT_AS_SHIFT   equ     6;
  27: 0040               INT_RAM_BYTES_HEIGHT            equ     64;// 1 << INT_RAM_BYTES_HEIGHT_AS_SHIFT
  28:                    
  29:                    // ================================================================
  30:                    //
  31:                    // To handle the peripherals:
  32: 8000               PERIPHERALS_BASE                equ     0x8000;
  33: 8000               TIMER_BASE                      equ     PERIPHERALS_BASE + 0x00;
  34: 8010               UART_BASE                       equ     PERIPHERALS_BASE + 0x10;
  35: 8020               INTERRUPT_BASE                  equ     PERIPHERALS_BASE + 0x20;
  36: 8030               GEN_IO_BASE                     equ     PERIPHERALS_BASE + 0x30;
  37:                    
  38:                    // register locations for the GPIO...
  39: 8030               GEN_IO_OUTPUT                   equ     GEN_IO_BASE + 0;
  40: 8032               GEN_IO_INPUT                    equ     GEN_IO_BASE + 2;
  41: 8034               GEN_IO_CTR                      equ     GEN_IO_BASE + 4;
  42:                    
  43:                    // register locations for the Timer...
  44: 8000               TIME_BLK_COUNTER                equ     TIMER_BASE + 0x00;
  45: 8002               TIME_BLK_TIMER                  equ     TIMER_BASE + 0x02;
  46: 8004               TIME_BLK_TIMER_CTRL             equ     TIMER_BASE + 0x04;
  47:                    // bit definitions for timer control register
  48: 0001               TIME_BLK_TIMER_CTRL_EN_TIMER    equ     0x01;
  49: 0002               TIME_BLK_TIMER_CTRL_CLR_COUNT   equ     0x02;
  50: 0004               TIME_BLK_TIMER_CTRL_CLR_TIMER   equ     0x04;
  51:                    
  52:                    // masks for selecting switch value on Venom Arcade Stick
  53:                    // (Switches are HIGH by "default", and go LOW on being pressed).
  54: 0001               IO_SWITCH_FLAG_UP               EQU     0x0001;
  55: 0002               IO_SWITCH_FLAG_DOWN             EQU     0x0002;
  56: 0004               IO_SWITCH_FLAG_LEFT             EQU     0x0004;
  57: 0008               IO_SWITCH_FLAG_RIGHT            EQU     0x0008;
  58: 0010               IO_SWITCH_FLAG_SQUARE           EQU     0x0010;
  59: 0020               IO_SWITCH_FLAG_TRIANGLE         EQU     0x0020;
  60: 0040               IO_SWITCH_FLAG_CIRCLE           EQU     0x0040;
  61: 0080               IO_SWITCH_FLAG_CROSS            EQU     0x0080;
  62: 0100               IO_SWITCH_FLAG_L1               EQU     0x0100;
  63: 0200               IO_SWITCH_FLAG_L2               EQU     0x0200;
  64: 0400               IO_SWITCH_FLAG_R1               EQU     0x0400;
  65: 0800               IO_SWITCH_FLAG_R2               EQU     0x0800;
  66:                    
  67:                    // register locations for the Interrupt controller...
  68: 8020               INTERRUPT_SOURCE                EQU     INTERRUPT_BASE + 0x00;
  69: 8021               INTERRUPT_MASK                  EQU     INTERRUPT_BASE + 0x01;
  70:                    
  71:                    // interrupt souurce enable/value bit masks
  72: 0001               INTERRUPT_BIT_USER              EQU     0x01;
  73: 0002               INTERRUPT_BIT_UART_SPACE        EQU     0x02;
  74: 0004               INTERRUPT_BIT_UART_RX_DATA      EQU     0x04;
  75: 0008               INTERRUPT_BIT_TIMER             EQU     0x08;
  76: 0010               INTERRUPT_BIT_COUNTER           EQU     0x10;
  77: 0020               INTERRUPT_BIT_INPUT_CHANGE      EQU     0x20;
  78:                    
  79:                    
  80:                    
  81:                    // *************************************
  82:                    // variables....
  83: 4000               org 0x4000;
  84:                    
  85:                    // We shall use two working arrays to hold two copies of our universe. The universe is 32 wide
  86:                    // by 64 tall. It is wraparound. To deal with the wraparound we shall replicate the outside edge
  87:                    // so our working arrays need to be 34 by 66.
  88: 4000 00 00 00 00     world_a:    ds  34*66;
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
  89: 4023               world_a_org equ world_a + 34 + 1;
  90: 48C4 00 00 00 00     world_b:    ds  34*66;
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
  91: 48E7               world_b_org equ world_b + 34 + 1;
  92: 5188 00              use_b:      db;
  93: 5189 00 00           dst_ptr:    dw;
  94: 518B 00 00           src_ptr:    dw;
  95: 518D 00 00           disp_ptr:   dw;
  96: 518F 00              row_count:  db;
  97: 5190 00              col_count:  db;
  98:                    
  99:                    // **************************************
 100:                    // code....
 101: 0000               org  0;
 102:                    
 103:                    // vectors
 104: 0000 F3 10 00        reset:       jmp    start;
 105: 0003 FF              nop;
 106: 0004 C7              ext_int:     reti;
 107: 0005 FF              nop;
 108: 0006 FF              nop;
 109: 0007 FF              nop;
 110: 0008 C7              div_zero:    reti;
 111: 0009 FF              nop;
 112: 000A FF              nop;
 113: 000B FF              nop;
 114: 000C C7              illegal:     reti;
 115: 000D FF              nop;
 116: 000E FF              nop;
 117: 000F FF              nop;
 118:                    
 119:                    // *********************
 120:                    // The program....
 121:                    start:
 122:                    // give ourselves a stck...
 123: 0010 D0 00 70        ld.w    r0,#0x7000;
 124: 0013 F1              move    sp,r0;
 125:                    
 126: 0014 CF 6D 00        jsr init;
 127: 0017 20              xor r0,r0;
 128: 0018 BC 88 51        st.b    use_b,r0; // so start with A
 129:                    main_loop:
 130: 001B CF 2D 00        jsr display_world;
 131: 001E CF 9C 00        jsr update_world;
 132: 0021 B4 88 51        ld.b    r0,use_b;
 133: 0024 D5 01           ld.b    r1,#1;
 134: 0026 21              xor r1,r0;
 135: 0027 BD 88 51        st.b    use_b,r1;
 136: 002A F3 1B 00        jmp main_loop;
 137:                    
 138:                    // *********************
 139:                    // To display a world we extract the core of the current world and format it
 140:                    // for the internal RAM.
 141:                    display_world:
 142: 002D D3 23 40        ld.w    r3,#world_a_org;
 143: 0030 B4 88 51        ld.b    r0,use_b;
 144: 0033 E7 03           beq dw1;
 145: 0035 D3 E7 48        ld.w    r3,#world_b_org;
 146:                    dw1:
 147: 0038 D2 00 A0        ld.w    r2,#INT_RAM_START;
 148: 003B BA 8D 51        st.w    disp_ptr,r2;
 149: 003E 20              xor r0,r0;
 150: 003F BC 8F 51        st.b    row_count,r0;
 151:                    dw4:
 152:                    // inner row loop
 153: 0042 20              xor r0,r0;  // r0 is loop counter
 154:                    dw5:
 155: 0043 2A              xor r2,r2;  // r2 is accumulator
 156:                    dw3:
 157: 0044 DA 1F           lsr r2,#1;
 158: 0046 97              ld.b    r1,(r3++);
 159: 0047 E7 03           beq dw2;
 160: 0049 D5 80           ld.b    r1,#128;
 161: 004B 46              add r2,r1;
 162:                    dw2:
 163: 004C 54              addq    r0,#1;
 164:                    // see if we have a byte to write
 165: 004D D5 07           ld.b    r1,#7;
 166: 004F 11              and r1,r0;
 167: 0050 E6 F2           bne dw3;    // no so do next bit
 168:                    
 169:                    // yes, so write it to display
 170: 0052 09              move    r1,r2;
 171: 0053 B2 8D 51        ld.w    r2,disp_ptr;
 172: 0056 9D              st.b    (r2++),r1;
 173: 0057 BA 8D 51        st.w    disp_ptr,r2;
 174:                    
 175:                    // now see if done end of row
 176: 005A D5 20           ld.b    r1,#32;
 177: 005C 74              cmp r0,r1;
 178: 005D E6 E4           bne dw5;    // no, so carry on.
 179:                    
 180:                    // end of row, so incr count and see if finished...
 181: 005F 53              addq    r3,#2;  // skip src ptr over replicating lines
 182: 0060 B6 8F 51        ld.b    r2,row_count;
 183: 0063 56              addq    r2,#1;
 184: 0064 BE 8F 51        st.b    row_count,r2;
 185: 0067 D4 40           ld.b    r0,#64;
 186: 0069 78              cmp r0,r2;
 187: 006A E6 D6           bne dw4;    // not finished yet
 188:                    
 189:                    // all done
 190: 006C C6              ret;
 191:                    
 192:                    // ***********************************
 193:                    // initialise world A to be blank with a blinker and a glider...
 194:                    init:
 195:                    
 196: 006D 20              xor     r0,r0;
 197: 006E D2 00 40        ld.w    r2,#world_a;
 198: 0071 D1 62 04        ld.w    r1,#34*66/2;
 199:                    clr_loop:
 200: 0074 98              st.w    (r2++),r0;
 201: 0075 59              addq    r1,#-2;
 202: 0076 E6 FC           bne     clr_loop;
 203:                    
 204: 0078 D4 01           ld.b    r0,#1;
 205: 007A BC 81 41        st.b    world_a_org + 10 + 10*34,r0;
 206: 007D BC 82 41        st.b    world_a_org + 11 + 10*34,r0;
 207: 0080 BC 83 41        st.b    world_a_org + 12 + 10*34,r0;
 208:                    
 209: 0083 BC 8B 41        st.b    world_a_org + 20 + 10*34,r0;
 210: 0086 BC AD 41        st.b    world_a_org + 20 + 11*34,r0;
 211: 0089 BC CF 41        st.b    world_a_org + 20 + 12*34,r0;
 212:                    
 213: 008C BC 30 44        st.b    world_a_org + 17 + 30*34,r0;
 214: 008F BC 50 44        st.b    world_a_org + 15 + 31*34,r0;
 215: 0092 BC 52 44        st.b    world_a_org + 17 + 31*34,r0;
 216: 0095 BC 73 44        st.b    world_a_org + 16 + 32*34,r0;
 217: 0098 BC 74 44        st.b    world_a_org + 17 + 32*34,r0;
 218:                    
 219: 009B C6              ret;
 220:                    
 221:                    // ***********************************
 222:                    // create a new generation in alternate universe
 223:                    update_world:
 224: 009C CF CF 00        jsr init_update;
 225:                    
 226: 009F D0 DD FF        ld.w    r0,#-35;
 227: 00A2 CF 88 01        jsr acc_field;
 228: 00A5 D0 DE FF        ld.w    r0,#-34;
 229: 00A8 CF 88 01        jsr acc_field;
 230: 00AB D0 DF FF        ld.w    r0,#-33;
 231: 00AE CF 88 01        jsr acc_field;
 232:                    
 233: 00B1 D0 FF FF        ld.w    r0,#-1;
 234: 00B4 CF 88 01        jsr acc_field;
 235:                    //      ld.b    r0,#0;
 236:                    //      jsr acc_field;
 237: 00B7 D4 01           ld.b    r0,#1;
 238: 00B9 CF 88 01        jsr acc_field;
 239:                    
 240: 00BC D4 21           ld.b    r0,#33;
 241: 00BE CF 88 01        jsr acc_field;
 242: 00C1 D4 22           ld.b    r0,#34;
 243: 00C3 CF 88 01        jsr acc_field;
 244: 00C6 D4 23           ld.b    r0,#35;
 245: 00C8 CF 88 01        jsr acc_field;
 246:                    
 247: 00CB CF B2 01        jsr life_death;
 248:                    
 249: 00CE C6              ret;
 250:                    
 251:                    // **********************************
 252:                    // to init calculation we extend edges of world to handle
 253:                    // wraparond, and init the accumulation to original world.
 254:                    init_update:
 255: 00CF D3 23 40        ld.w    r3,#world_a_org;
 256: 00D2 D2 E7 48        ld.w    r2,#world_b_org;
 257: 00D5 B4 88 51        ld.b    r0,use_b;
 258: 00D8 E7 06           beq iu1;
 259: 00DA D3 E7 48        ld.w    r3,#world_b_org;
 260: 00DD D2 23 40        ld.w    r2,#world_a_org;
 261:                    iu1:
 262: 00E0 BB 8B 51        st.w    src_ptr,R3;
 263: 00E3 BA 89 51        st.w    dst_ptr,R2;
 264:                    
 265:                    // TL corner comes from BR
 266: 00E6 D1 7D 08        ld.w    r1,#63*34+31;
 267: 00E9 0E              move    r2,r3;
 268: 00EA 46              add r2,r1;
 269: 00EB 84              ld.b    r0,(r2);
 270: 00EC D1 DD FF        ld.w    r1,#-35;
 271: 00EF 0E              move    r2,r3;
 272: 00F0 46              add r2,r1;
 273: 00F1 8C              st.b    (r2),r0;
 274:                    
 275:                    // TR corner comes from BL
 276: 00F2 D1 80 08        ld.w    r1,#64*34;
 277: 00F5 0E              move    r2,r3;
 278: 00F6 46              add r2,r1;
 279: 00F7 84              ld.b    r0,(r2);
 280: 00F8 D1 FE FF        ld.w    r1,#-2;
 281: 00FB 0E              move    r2,r3;
 282: 00FC 46              add r2,r1;
 283: 00FD 8C              st.b    (r2),r0;
 284:                    
 285:                    // BL corner comes from TR
 286: 00FE D1 1F 00        ld.w    r1,#31;
 287: 0101 0E              move    r2,r3;
 288: 0102 46              add r2,r1;
 289: 0103 84              ld.b    r0,(r2);
 290: 0104 D1 7F 08        ld.w    r1,#64*34-1;
 291: 0107 0E              move    r2,r3;
 292: 0108 46              add r2,r1;
 293: 0109 8C              st.b    (r2),r0;
 294:                    
 295:                    // BR corner comes from TL
 296: 010A D1 00 00        ld.w    r1,#0;
 297: 010D 0E              move    r2,r3;
 298: 010E 46              add r2,r1;
 299: 010F 84              ld.b    r0,(r2);
 300: 0110 D1 A0 08        ld.w    r1,#64*34+32;
 301: 0113 0E              move    r2,r3;
 302: 0114 46              add r2,r1;
 303: 0115 8C              st.b    (r2),r0;
 304:                    
 305:                    // top edge goes to bottom
 306: 0116 B2 8B 51        ld.w    r2,src_ptr;
 307: 0119 B3 8B 51        ld.w    r3,src_ptr;
 308: 011C D1 80 08        ld.w    r1,#64*34;
 309: 011F 47              add r3,r1;
 310: 0120 D5 20           ld.b    r1,#32;
 311:                    iu2:
 312: 0122 94              ld.b    r0,(r2++);
 313: 0123 9E              st.b    (r3++),r0;
 314: 0124 5D              addq    r1,#-1;
 315: 0125 E6 FB           bne iu2;
 316:                    
 317:                    // bottom edge goes to top
 318: 0127 B2 8B 51        ld.w    r2,src_ptr;
 319: 012A D1 5E 08        ld.w    r1,#63*34;
 320: 012D 46              add r2,r1;
 321: 012E B3 8B 51        ld.w    r3,src_ptr;
 322: 0131 D1 DE FF        ld.w    r1,#-34;
 323: 0134 47              add r3,r1;
 324: 0135 D5 20           ld.b    r1,#32;
 325:                    iu3:
 326: 0137 94              ld.b    r0,(r2++);
 327: 0138 9E              st.b    (r3++),r0;
 328: 0139 5D              addq    r1,#-1;
 329: 013A E6 FB           bne iu3;
 330:                    
 331:                    // left edge goes to right
 332: 013C B2 8B 51        ld.w    r2,src_ptr;
 333: 013F B3 8B 51        ld.w    r3,src_ptr;
 334: 0142 D1 20 00        ld.w    r1,#32;
 335: 0145 47              add r3,r1;
 336: 0146 D5 40           ld.b    r1,#64;
 337:                    iu4:
 338: 0148 84              ld.b    r0,(r2);
 339: 0149 8E              st.b    (r3),r0;
 340: 014A D4 22           ld.b    r0,#34;
 341: 014C 42              add r2,r0;
 342: 014D 43              add r3,r0;
 343: 014E 5D              addq    r1,#-1;
 344: 014F E6 F7           bne iu4;
 345:                    
 346:                    // right edge goes to left
 347: 0151 B2 8B 51        ld.w    r2,src_ptr;
 348: 0154 D1 1F 00        ld.w    r1,#31;
 349: 0157 46              add r2,r1;
 350: 0158 B3 8B 51        ld.w    r3,src_ptr;
 351: 015B D1 FF FF        ld.w    r1,#-1;
 352: 015E 47              add r3,r1;
 353: 015F D5 40           ld.b    r1,#64;
 354:                    iu5:
 355: 0161 84              ld.b    r0,(r2);
 356: 0162 8E              st.b    (r3),r0;
 357: 0163 D4 22           ld.b    r0,#34;
 358: 0165 42              add r2,r0;
 359: 0166 43              add r3,r0;
 360: 0167 5D              addq    r1,#-1;
 361: 0168 E6 F7           bne iu5;
 362:                    
 363:                    
 364:                    // now copy core of src world to dst to act as init of accum
 365: 016A B2 8B 51        ld.w    r2,src_ptr;
 366: 016D B3 89 51        ld.w    r3,dst_ptr;
 367: 0170 D4 40           ld.b    r0,#64;
 368: 0172 BC 8F 51        st.b    row_count,r0;
 369:                    iu6:
 370: 0175 D4 10           ld.b    r0,#16; // we'll do copy as words so tice as quick
 371:                    iu7:
 372: 0177 91              ld.w    r1,(r2++);
 373: 0178 9B              st.w    (r3++),r1;
 374: 0179 5C              addq    r0,#-1;
 375: 017A E6 FB           bne iu7;
 376: 017C 52              addq    r2,#+2;
 377: 017D 53              addq    r3,#2;
 378: 017E B5 8F 51        ld.b    r1,row_count;
 379: 0181 5D              addq    r1,#-1;
 380: 0182 BD 8F 51        st.b    row_count,r1;
 381: 0185 E6 EE           bne iu6;
 382:                    
 383: 0187 C6              ret;
 384:                    
 385:                    // *****************************************
 386:                    // here we accumulate counts from neighbours...
 387:                    // The offset will be in R0.
 388:                    acc_field:
 389: 0188 B2 8B 51        ld.w    r2,src_ptr;
 390: 018B 42              add r2,r0;
 391: 018C B3 89 51        ld.w    r3,dst_ptr;
 392: 018F D4 40           ld.b    r0,#64;
 393: 0191 BC 8F 51        st.b    row_count,r0;
 394:                    af1:
 395: 0194 D4 10           ld.b    r0,#16; // we'll do copy as words so twice as quick
 396: 0196 BC 90 51        st.b    col_count,r0;
 397:                    af2:
 398: 0199 91              ld.w    r1,(r2++);
 399: 019A 82              ld.w    r0,(r3);
 400: 019B 41              add r1,r0;  // we can add the two bytes in parallel as a word as there is no danger of overflow
 401: 019C 9B              st.w    (r3++),r1;
 402: 019D B4 90 51        ld.b    r0,col_count;
 403: 01A0 5C              addq    r0,#-1;
 404: 01A1 B8 90 51        st.w    col_count,r0;
 405: 01A4 E6 F3           bne af2;
 406: 01A6 52              addq    r2,#+2;
 407: 01A7 53              addq    r3,#2;
 408: 01A8 B5 8F 51        ld.b    r1,row_count;
 409: 01AB 5D              addq    r1,#-1;
 410: 01AC BD 8F 51        st.b    row_count,r1;
 411: 01AF E6 E3           bne af1;
 412:                    
 413: 01B1 C6              ret;
 414:                    
 415:                    // ***********************************
 416:                    // here we look at the accumulator to see if we have life or death..
 417:                    life_death:
 418: 01B2 B2 8B 51        ld.w    r2,src_ptr;
 419: 01B5 B3 89 51        ld.w    r3,dst_ptr;
 420: 01B8 D4 40           ld.b    r0,#64;
 421: 01BA BC 8F 51        st.b    row_count,r0;
 422:                    ld1:
 423: 01BD D4 20           ld.b    r0,#32;
 424: 01BF BC 90 51        st.b    col_count,r0;
 425:                    ld2:
 426: 01C2 87              ld.b    r1,(r3);
 427: 01C3 D4 03           ld.b    r0,#3;
 428: 01C5 74              cmp r0,r1;
 429: 01C6 E6 07           bne ld3;
 430:                    // a count of 3 is live
 431: 01C8 D4 01           ld.b    r0,#1;
 432: 01CA 9E              st.b    (r3++),r0;
 433: 01CB 56              addq    r2,#1;
 434: 01CC F3 DC 01        jmp ld4;
 435:                    ld3:
 436:                    // a count of 4 means retain current
 437: 01CF D4 04           ld.b    r0,#4;
 438: 01D1 74              cmp r0,r1;
 439: 01D2 E6 05           bne ld5;
 440: 01D4 95              ld.b    r1,(r2++);
 441: 01D5 9F              st.b    (r3++),r1;
 442: 01D6 F3 DC 01        jmp ld4;
 443:                    ld5:
 444:                    // a count not 3 or 4 meqns death
 445: 01D9 25              xor r1,r1;
 446: 01DA 9F              st.b    (r3++),r1;
 447: 01DB 56              addq    r2,#1;
 448:                    // drop thru...
 449:                    
 450:                    ld4:
 451: 01DC B4 90 51        ld.b    r0,col_count;
 452: 01DF 5C              addq    r0,#-1;
 453: 01E0 BC 90 51        st.b    col_count,r0;
 454: 01E3 E6 DD           bne ld2;
 455:                    
 456: 01E5 52              addq    r2,#2;
 457: 01E6 53              addq    r3,#2;
 458:                    
 459: 01E7 B4 8F 51        ld.b    r0,row_count;
 460: 01EA 5C              addq    r0,#-1;
 461: 01EB BC 8F 51        st.b    row_count,r0;
 462: 01EE E6 CD           bne ld1;
 463:                    
 464: 01F0 C6              ret;
 465:                    
 466:                    // *******************************************************
 467:                    
