   1:                    // Start with shared definitions...
   2:                    // ===============================================================
   3:                    //
   4:                    // Megaprocessor
   5:                    // =============
   6:                    // This file holds definitions useful for writing assembler
   7:                    // programs for the Megaprocessor.
   8:                    //
   9:                    // This version : 15th May 2016
  10:                    //
  11:                    // ================================================================
  12:                    //
  13:                    // Coding
  14:                    // =======
  15:                    // definition for interrupt enable bit
  16: 0001               PS_INT_ENABLE_BIT               equ     0x01;
  17:                    
  18:                    // ================================================================
  19:                    //
  20:                    // To handle the 256 bytes of RAM built from discrete components:
  21: A000               INT_RAM_START                   equ     0xA000;
  22: 0100               INT_RAM_LEN                     equ     0x0100;
  23:                    
  24: 0004               INT_RAM_BYTES_ACROSS            equ     4;
  25: 0006               INT_RAM_BYTES_HEIGHT_AS_SHIFT   equ     6;
  26: 0040               INT_RAM_BYTES_HEIGHT            equ     64;// 1 << INT_RAM_BYTES_HEIGHT_AS_SHIFT
  27:                    
  28:                    // ================================================================
  29:                    //
  30:                    // To handle the peripherals:
  31: 8000               PERIPHERALS_BASE                equ     0x8000;
  32: 8000               TIMER_BASE                      equ     PERIPHERALS_BASE + 0x00;
  33: 8010               UART_BASE                       equ     PERIPHERALS_BASE + 0x10;
  34: 8020               INTERRUPT_BASE                  equ     PERIPHERALS_BASE + 0x20;
  35: 8030               GEN_IO_BASE                     equ     PERIPHERALS_BASE + 0x30;
  36:                    
  37:                    // register locations for the GPIO...
  38: 8030               GEN_IO_OUTPUT                   equ     GEN_IO_BASE + 0;
  39: 8032               GEN_IO_INPUT                    equ     GEN_IO_BASE + 2;
  40: 8034               GEN_IO_CTR                      equ     GEN_IO_BASE + 4;
  41:                    
  42:                    // register locations for the Timer...
  43: 8000               TIME_BLK_COUNTER                equ     TIMER_BASE + 0x00;
  44: 8002               TIME_BLK_TIMER                  equ     TIMER_BASE + 0x02;
  45: 8004               TIME_BLK_TIMER_CTRL             equ     TIMER_BASE + 0x04;
  46:                    // bit definitions for timer control register
  47: 0001               TIME_BLK_TIMER_CTRL_EN_TIMER    equ     0x01;
  48: 0002               TIME_BLK_TIMER_CTRL_CLR_COUNT   equ     0x02;
  49: 0004               TIME_BLK_TIMER_CTRL_CLR_TIMER   equ     0x04;
  50:                    
  51:                    // masks for selecting switch value on Venom Arcade Stick
  52:                    // (Switches are HIGH by "default", and go LOW on being pressed).
  53: 0001               IO_SWITCH_FLAG_UP               EQU     0x0001;
  54: 0002               IO_SWITCH_FLAG_DOWN             EQU     0x0002;
  55: 0004               IO_SWITCH_FLAG_LEFT             EQU     0x0004;
  56: 0008               IO_SWITCH_FLAG_RIGHT            EQU     0x0008;
  57: 0010               IO_SWITCH_FLAG_SQUARE           EQU     0x0010;
  58: 0020               IO_SWITCH_FLAG_TRIANGLE         EQU     0x0020;
  59: 0040               IO_SWITCH_FLAG_CIRCLE           EQU     0x0040;
  60: 0080               IO_SWITCH_FLAG_CROSS            EQU     0x0080;
  61: 0100               IO_SWITCH_FLAG_L1               EQU     0x0100;
  62: 0200               IO_SWITCH_FLAG_L2               EQU     0x0200;
  63: 0400               IO_SWITCH_FLAG_R1               EQU     0x0400;
  64: 0800               IO_SWITCH_FLAG_R2               EQU     0x0800;
  65:                    
  66:                    // register locations for the Interrupt controller...
  67: 8020               INTERRUPT_SOURCE                EQU     INTERRUPT_BASE + 0x00;
  68: 8021               INTERRUPT_MASK                  EQU     INTERRUPT_BASE + 0x01;
  69:                    
  70:                    // interrupt souurce enable/value bit masks
  71: 0001               INTERRUPT_BIT_USER              EQU     0x01;
  72: 0002               INTERRUPT_BIT_UART_SPACE        EQU     0x02;
  73: 0004               INTERRUPT_BIT_UART_RX_DATA      EQU     0x04;
  74: 0008               INTERRUPT_BIT_TIMER             EQU     0x08;
  75: 0010               INTERRUPT_BIT_COUNTER           EQU     0x10;
  76: 0020               INTERRUPT_BIT_INPUT_CHANGE      EQU     0x20;
  77:                    
  78:                    
  79:                    // *************************************
  80:                    // variables....
  81: 4000               org 0x4000;
  82:                    
  83:                    // We shall use two working arrays to hold two copies of our universe. The universe is 32 wide
  84:                    // by 64 tall. It is wraparound. To deal with the wraparound we shall replicate the outside edge
  85:                    // so our working arrays need to be 34 by 66.
  86: 4000 00 00 00 00     world_a:    ds  34*66;
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
  87: 4023               world_a_org equ world_a + 34 + 1;
  88: 48C4 00 00 00 00     world_b:    ds  34*66;
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
          00 00 00 00 
  89: 48E7               world_b_org equ world_b + 34 + 1;
  90: 5188 00              use_b:      db;
  91: 5189 00 00           dst_ptr:    dw;
  92: 518B 00 00           src_ptr:    dw;
  93: 518D 00 00           disp_ptr:   dw;
  94: 518F 00              row_count:  db;
  95: 5190 00              col_count:  db;
  96:                    
  97:                    // **************************************
  98:                    // code....
  99: 0000               org  0;
 100:                    
 101:                    // vectors
 102: 0000 F3 10 00        reset:       jmp    start;
 103: 0003 FF              nop;
 104: 0004 C7              ext_int:     reti;
 105: 0005 FF              nop;
 106: 0006 FF              nop;
 107: 0007 FF              nop;
 108: 0008 C7              div_zero:    reti;
 109: 0009 FF              nop;
 110: 000A FF              nop;
 111: 000B FF              nop;
 112: 000C C7              illegal:     reti;
 113: 000D FF              nop;
 114: 000E FF              nop;
 115: 000F FF              nop;
 116:                    
 117:                    // *********************
 118:                    // The program....
 119:                    start:
 120:                    // give ourselves a stck...
 121: 0010 D0 00 70        ld.w    r0,#0x7000;
 122: 0013 F1              move    sp,r0;
 123:                    
 124: 0014 CF 6D 00        jsr init;
 125: 0017 20              xor r0,r0;
 126: 0018 BC 88 51        st.b    use_b,r0; // so start with A
 127:                    main_loop:
 128: 001B CF 2D 00        jsr display_world;
 129: 001E CF 9C 00        jsr update_world;
 130: 0021 B4 88 51        ld.b    r0,use_b;
 131: 0024 D5 01           ld.b    r1,#1;
 132: 0026 21              xor r1,r0;
 133: 0027 BD 88 51        st.b    use_b,r1;
 134: 002A F3 1B 00        jmp main_loop;
 135:                    
 136:                    // *********************
 137:                    // To display a world we extract the core of the current world and format it
 138:                    // for the internal RAM.
 139:                    display_world:
 140: 002D D3 23 40        ld.w    r3,#world_a_org;
 141: 0030 B4 88 51        ld.b    r0,use_b;
 142: 0033 E7 03           beq dw1;
 143: 0035 D3 E7 48        ld.w    r3,#world_b_org;
 144:                    dw1:
 145: 0038 D2 00 A0        ld.w    r2,#INT_RAM_START;
 146: 003B BA 8D 51        st.w    disp_ptr,r2;
 147: 003E 20              xor r0,r0;
 148: 003F BC 8F 51        st.b    row_count,r0;
 149:                    dw4:
 150:                    // inner row loop
 151: 0042 20              xor r0,r0;  // r0 is loop counter
 152:                    dw5:
 153: 0043 2A              xor r2,r2;  // r2 is accumulator
 154:                    dw3:
 155: 0044 DA 1F           lsr r2,#1;
 156: 0046 97              ld.b    r1,(r3++);
 157: 0047 E7 03           beq dw2;
 158: 0049 D5 80           ld.b    r1,#128;
 159: 004B 46              add r2,r1;
 160:                    dw2:
 161: 004C 54              addq    r0,#1;
 162:                    // see if we have a byte to write
 163: 004D D5 07           ld.b    r1,#7;
 164: 004F 11              and r1,r0;
 165: 0050 E6 F2           bne dw3;    // no so do next bit
 166:                    
 167:                    // yes, so write it to display
 168: 0052 09              move    r1,r2;
 169: 0053 B2 8D 51        ld.w    r2,disp_ptr;
 170: 0056 9D              st.b    (r2++),r1;
 171: 0057 BA 8D 51        st.w    disp_ptr,r2;
 172:                    
 173:                    // now see if done end of row
 174: 005A D5 20           ld.b    r1,#32;
 175: 005C 74              cmp r0,r1;
 176: 005D E6 E4           bne dw5;    // no, so carry on.
 177:                    
 178:                    // end of row, so incr count and see if finished...
 179: 005F 53              addq    r3,#2;  // skip src ptr over replicating lines
 180: 0060 B6 8F 51        ld.b    r2,row_count;
 181: 0063 56              addq    r2,#1;
 182: 0064 BE 8F 51        st.b    row_count,r2;
 183: 0067 D4 40           ld.b    r0,#64;
 184: 0069 78              cmp r0,r2;
 185: 006A E6 D6           bne dw4;    // not finished yet
 186:                    
 187:                    // all done
 188: 006C C6              ret;
 189:                    
 190:                    // ***********************************
 191:                    // initialise world A to be blank with a blinker and a glider...
 192:                    init:
 193:                    
 194: 006D 20              xor     r0,r0;
 195: 006E D2 00 40        ld.w    r2,#world_a;
 196: 0071 D1 62 04        ld.w    r1,#34*66/2;
 197:                    clr_loop:
 198: 0074 98              st.w    (r2++),r0;
 199: 0075 59              addq    r1,#-2;
 200: 0076 E6 FC           bne     clr_loop;
 201:                    
 202: 0078 D4 01           ld.b    r0,#1;
 203: 007A BC 81 41        st.b    world_a_org + 10 + 10*34,r0;
 204: 007D BC 82 41        st.b    world_a_org + 11 + 10*34,r0;
 205: 0080 BC 83 41        st.b    world_a_org + 12 + 10*34,r0;
 206:                    
 207: 0083 BC 8B 41        st.b    world_a_org + 20 + 10*34,r0;
 208: 0086 BC AD 41        st.b    world_a_org + 20 + 11*34,r0;
 209: 0089 BC CF 41        st.b    world_a_org + 20 + 12*34,r0;
 210:                    
 211: 008C BC 30 44        st.b    world_a_org + 17 + 30*34,r0;
 212: 008F BC 50 44        st.b    world_a_org + 15 + 31*34,r0;
 213: 0092 BC 52 44        st.b    world_a_org + 17 + 31*34,r0;
 214: 0095 BC 73 44        st.b    world_a_org + 16 + 32*34,r0;
 215: 0098 BC 74 44        st.b    world_a_org + 17 + 32*34,r0;
 216:                    
 217: 009B C6              ret;
 218:                    
 219:                    // ***********************************
 220:                    // create a new generation in alternate universe
 221:                    update_world:
 222: 009C CF CF 00        jsr init_update;
 223:                    
 224: 009F D0 DD FF        ld.w    r0,#-35;
 225: 00A2 CF 88 01        jsr acc_field;
 226: 00A5 D0 DE FF        ld.w    r0,#-34;
 227: 00A8 CF 88 01        jsr acc_field;
 228: 00AB D0 DF FF        ld.w    r0,#-33;
 229: 00AE CF 88 01        jsr acc_field;
 230:                    
 231: 00B1 D0 FF FF        ld.w    r0,#-1;
 232: 00B4 CF 88 01        jsr acc_field;
 233:                    //      ld.b    r0,#0;
 234:                    //      jsr acc_field;
 235: 00B7 D4 01           ld.b    r0,#1;
 236: 00B9 CF 88 01        jsr acc_field;
 237:                    
 238: 00BC D4 21           ld.b    r0,#33;
 239: 00BE CF 88 01        jsr acc_field;
 240: 00C1 D4 22           ld.b    r0,#34;
 241: 00C3 CF 88 01        jsr acc_field;
 242: 00C6 D4 23           ld.b    r0,#35;
 243: 00C8 CF 88 01        jsr acc_field;
 244:                    
 245: 00CB CF B2 01        jsr life_death;
 246:                    
 247: 00CE C6              ret;
 248:                    
 249:                    // **********************************
 250:                    // to init calculation we extend edges of world to handle
 251:                    // wraparond, and init the accumulation to original world.
 252:                    init_update:
 253: 00CF D3 23 40        ld.w    r3,#world_a_org;
 254: 00D2 D2 E7 48        ld.w    r2,#world_b_org;
 255: 00D5 B4 88 51        ld.b    r0,use_b;
 256: 00D8 E7 06           beq iu1;
 257: 00DA D3 E7 48        ld.w    r3,#world_b_org;
 258: 00DD D2 23 40        ld.w    r2,#world_a_org;
 259:                    iu1:
 260: 00E0 BB 8B 51        st.w    src_ptr,R3;
 261: 00E3 BA 89 51        st.w    dst_ptr,R2;
 262:                    
 263:                    // TL corner comes from BR
 264: 00E6 D1 7D 08        ld.w    r1,#63*34+31;
 265: 00E9 0E              move    r2,r3;
 266: 00EA 46              add r2,r1;
 267: 00EB 84              ld.b    r0,(r2);
 268: 00EC D1 DD FF        ld.w    r1,#-35;
 269: 00EF 0E              move    r2,r3;
 270: 00F0 46              add r2,r1;
 271: 00F1 8C              st.b    (r2),r0;
 272:                    
 273:                    // TR corner comes from BL
 274: 00F2 D1 80 08        ld.w    r1,#64*34;
 275: 00F5 0E              move    r2,r3;
 276: 00F6 46              add r2,r1;
 277: 00F7 84              ld.b    r0,(r2);
 278: 00F8 D1 FE FF        ld.w    r1,#-2;
 279: 00FB 0E              move    r2,r3;
 280: 00FC 46              add r2,r1;
 281: 00FD 8C              st.b    (r2),r0;
 282:                    
 283:                    // BL corner comes from TR
 284: 00FE D1 1F 00        ld.w    r1,#31;
 285: 0101 0E              move    r2,r3;
 286: 0102 46              add r2,r1;
 287: 0103 84              ld.b    r0,(r2);
 288: 0104 D1 7F 08        ld.w    r1,#64*34-1;
 289: 0107 0E              move    r2,r3;
 290: 0108 46              add r2,r1;
 291: 0109 8C              st.b    (r2),r0;
 292:                    
 293:                    // BR corner comes from TL
 294: 010A D1 00 00        ld.w    r1,#0;
 295: 010D 0E              move    r2,r3;
 296: 010E 46              add r2,r1;
 297: 010F 84              ld.b    r0,(r2);
 298: 0110 D1 A0 08        ld.w    r1,#64*34+32;
 299: 0113 0E              move    r2,r3;
 300: 0114 46              add r2,r1;
 301: 0115 8C              st.b    (r2),r0;
 302:                    
 303:                    // top edge goes to bottom
 304: 0116 B2 8B 51        ld.w    r2,src_ptr;
 305: 0119 B3 8B 51        ld.w    r3,src_ptr;
 306: 011C D1 80 08        ld.w    r1,#64*34;
 307: 011F 47              add r3,r1;
 308: 0120 D5 20           ld.b    r1,#32;
 309:                    iu2:
 310: 0122 94              ld.b    r0,(r2++);
 311: 0123 9E              st.b    (r3++),r0;
 312: 0124 5D              addq    r1,#-1;
 313: 0125 E6 FB           bne iu2;
 314:                    
 315:                    // bottom edge goes to top
 316: 0127 B2 8B 51        ld.w    r2,src_ptr;
 317: 012A D1 5E 08        ld.w    r1,#63*34;
 318: 012D 46              add r2,r1;
 319: 012E B3 8B 51        ld.w    r3,src_ptr;
 320: 0131 D1 DE FF        ld.w    r1,#-34;
 321: 0134 47              add r3,r1;
 322: 0135 D5 20           ld.b    r1,#32;
 323:                    iu3:
 324: 0137 94              ld.b    r0,(r2++);
 325: 0138 9E              st.b    (r3++),r0;
 326: 0139 5D              addq    r1,#-1;
 327: 013A E6 FB           bne iu3;
 328:                    
 329:                    // left edge goes to right
 330: 013C B2 8B 51        ld.w    r2,src_ptr;
 331: 013F B3 8B 51        ld.w    r3,src_ptr;
 332: 0142 D1 20 00        ld.w    r1,#32;
 333: 0145 47              add r3,r1;
 334: 0146 D5 40           ld.b    r1,#64;
 335:                    iu4:
 336: 0148 84              ld.b    r0,(r2);
 337: 0149 8E              st.b    (r3),r0;
 338: 014A D4 22           ld.b    r0,#34;
 339: 014C 42              add r2,r0;
 340: 014D 43              add r3,r0;
 341: 014E 5D              addq    r1,#-1;
 342: 014F E6 F7           bne iu4;
 343:                    
 344:                    // right edge goes to left
 345: 0151 B2 8B 51        ld.w    r2,src_ptr;
 346: 0154 D1 1F 00        ld.w    r1,#31;
 347: 0157 46              add r2,r1;
 348: 0158 B3 8B 51        ld.w    r3,src_ptr;
 349: 015B D1 FF FF        ld.w    r1,#-1;
 350: 015E 47              add r3,r1;
 351: 015F D5 40           ld.b    r1,#64;
 352:                    iu5:
 353: 0161 84              ld.b    r0,(r2);
 354: 0162 8E              st.b    (r3),r0;
 355: 0163 D4 22           ld.b    r0,#34;
 356: 0165 42              add r2,r0;
 357: 0166 43              add r3,r0;
 358: 0167 5D              addq    r1,#-1;
 359: 0168 E6 F7           bne iu5;
 360:                    
 361:                    
 362:                    // now copy core of src world to dst to act as init of accum
 363: 016A B2 8B 51        ld.w    r2,src_ptr;
 364: 016D B3 89 51        ld.w    r3,dst_ptr;
 365: 0170 D4 40           ld.b    r0,#64;
 366: 0172 BC 8F 51        st.b    row_count,r0;
 367:                    iu6:
 368: 0175 D4 10           ld.b    r0,#16; // we'll do copy as words so tice as quick
 369:                    iu7:
 370: 0177 91              ld.w    r1,(r2++);
 371: 0178 9B              st.w    (r3++),r1;
 372: 0179 5C              addq    r0,#-1;
 373: 017A E6 FB           bne iu7;
 374: 017C 52              addq    r2,#+2;
 375: 017D 53              addq    r3,#2;
 376: 017E B5 8F 51        ld.b    r1,row_count;
 377: 0181 5D              addq    r1,#-1;
 378: 0182 BD 8F 51        st.b    row_count,r1;
 379: 0185 E6 EE           bne iu6;
 380:                    
 381: 0187 C6              ret;
 382:                    
 383:                    // *****************************************
 384:                    // here we accumulate counts from neighbours...
 385:                    // The offset will be in R0.
 386:                    acc_field:
 387: 0188 B2 8B 51        ld.w    r2,src_ptr;
 388: 018B 42              add r2,r0;
 389: 018C B3 89 51        ld.w    r3,dst_ptr;
 390: 018F D4 40           ld.b    r0,#64;
 391: 0191 BC 8F 51        st.b    row_count,r0;
 392:                    af1:
 393: 0194 D4 10           ld.b    r0,#16; // we'll do copy as words so twice as quick
 394: 0196 BC 90 51        st.b    col_count,r0;
 395:                    af2:
 396: 0199 91              ld.w    r1,(r2++);
 397: 019A 82              ld.w    r0,(r3);
 398: 019B 41              add r1,r0;  // we can add the two bytes in parallel as a word as there is no danger of overflow
 399: 019C 9B              st.w    (r3++),r1;
 400: 019D B4 90 51        ld.b    r0,col_count;
 401: 01A0 5C              addq    r0,#-1;
 402: 01A1 B8 90 51        st.w    col_count,r0;
 403: 01A4 E6 F3           bne af2;
 404: 01A6 52              addq    r2,#+2;
 405: 01A7 53              addq    r3,#2;
 406: 01A8 B5 8F 51        ld.b    r1,row_count;
 407: 01AB 5D              addq    r1,#-1;
 408: 01AC BD 8F 51        st.b    row_count,r1;
 409: 01AF E6 E3           bne af1;
 410:                    
 411: 01B1 C6              ret;
 412:                    
 413:                    // ***********************************
 414:                    // here we look at the accumulator to see if we have life or death..
 415:                    life_death:
 416: 01B2 B2 8B 51        ld.w    r2,src_ptr;
 417: 01B5 B3 89 51        ld.w    r3,dst_ptr;
 418: 01B8 D4 40           ld.b    r0,#64;
 419: 01BA BC 8F 51        st.b    row_count,r0;
 420:                    ld1:
 421: 01BD D4 20           ld.b    r0,#32;
 422: 01BF BC 90 51        st.b    col_count,r0;
 423:                    ld2:
 424: 01C2 87              ld.b    r1,(r3);
 425: 01C3 D4 03           ld.b    r0,#3;
 426: 01C5 74              cmp r0,r1;
 427: 01C6 E6 07           bne ld3;
 428:                    // a count of 3 is live
 429: 01C8 D4 01           ld.b    r0,#1;
 430: 01CA 9E              st.b    (r3++),r0;
 431: 01CB 56              addq    r2,#1;
 432: 01CC F3 DC 01        jmp ld4;
 433:                    ld3:
 434:                    // a count of 4 means retain current
 435: 01CF D4 04           ld.b    r0,#4;
 436: 01D1 74              cmp r0,r1;
 437: 01D2 E6 05           bne ld5;
 438: 01D4 95              ld.b    r1,(r2++);
 439: 01D5 9F              st.b    (r3++),r1;
 440: 01D6 F3 DC 01        jmp ld4;
 441:                    ld5:
 442:                    // a count not 3 or 4 meqns death
 443: 01D9 25              xor r1,r1;
 444: 01DA 9F              st.b    (r3++),r1;
 445: 01DB 56              addq    r2,#1;
 446:                    // drop thru...
 447:                    
 448:                    ld4:
 449: 01DC B4 90 51        ld.b    r0,col_count;
 450: 01DF 5C              addq    r0,#-1;
 451: 01E0 BC 90 51        st.b    col_count,r0;
 452: 01E3 E6 DD           bne ld2;
 453:                    
 454: 01E5 52              addq    r2,#2;
 455: 01E6 53              addq    r3,#2;
 456:                    
 457: 01E7 B4 8F 51        ld.b    r0,row_count;
 458: 01EA 5C              addq    r0,#-1;
 459: 01EB BC 8F 51        st.b    row_count,r0;
 460: 01EE E6 CD           bne ld1;
 461:                    
 462: 01F0 C6              ret;
 463:                    
 464:                    // *******************************************************
